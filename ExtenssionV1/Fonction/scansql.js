export function performSqlInjectionScan() {
    console.log("Scan d'injections SQL en cours...");

    // Fonction pour vérifier si les validations des entrées utilisateur existent
    function checkFormValidation() {
        var forms = document.querySelectorAll('form');
        var validationExists = false;
        forms.forEach(function(form) {
            // Vérifie si le formulaire a l'attribut "novalidate"
            if (!form.hasAttribute('novalidate')) {
                validationExists = true;
            }
        });
        return validationExists;
    }

    // Fonction pour vérifier si une chaîne de caractères contient une requête non préparée
    function hasUnpreparedQuery(code) {
        // Expression régulière pour rechercher les requêtes non préparées
        var regex = /\b(query|exec|fetch|execute|queryOne|queryAll|get|post|put|delete|insert|update|delete)\(/gi;
        // Test si la chaîne de caractères contient la regex
        return regex.test(code);
    }

    // Fonction pour vérifier si une chaîne de caractères contient une méthode d'échappement insecure
    function hasInsecureEscapingMethod(code) {
        // Expression régulière pour rechercher des méthodes d'échappement SQL
        var regex = /escape_string\(|mysql_real_escape_string\(|mysqli_real_escape_string\(|PDO::quote\(|pg_escape_string\(|sqlite_escape_string\(|mysql_escape_string\(|addslashes\(|htmlentities\(|htmlspecialchars\(|filter_var\(|\bregexp_replace\(|\bregexp_replace_icase\(|\bregexp_replace_multi\(|\bstr_replace\(|\bstr_ireplace\(|\bstrtr\(|\bstrtr_array\(|\bstrtr_arraycase\(|\bstrtr_unicode\(|\bstrtr_unicodecase\(|\bstrtr_arr_utf8\(|\bstrtr_arr_utf8_icase\(|\bstrtr_arr_utf8_ucase\(|\bstrtr_arr_utf8_lcase\(|\bstrtr_utf8\(|\bstrtr_utf8_icase\(|\bstrtr_utf8_ucase\(|\bstrtr_utf8_lcase\(|\bstrtr_utf8_arr\(|\bstrtr_utf8_arr_icase\(|\bstrtr_utf8_arr_ucase\(|\bstrtr_utf8_arr_lcase\(|\bmysql_real_escape_string\(|\bmysql_escape_string\(|\bmysqli_real_escape_string\(|\bmysqli_escape_string\(|\bpg_escape_string\(|\bpdo->quote\(/gi;

        // Test si la chaîne de caractères ne contient pas la regex
        return !regex.test(code);
    }

    // Vérification des mesures de sécurité
    var formsValidated = checkFormValidation();
    var unpreparedQueriesFound = hasUnpreparedQuery(document.body.innerText);
    var insecureEscapingMethodsFound = hasInsecureEscapingMethod(document.body.innerText);

    if (formsValidated) {
        console.log('Validation des entrées utilisateur détectée.');
    } else {
        console.log('Aucune validation des entrées utilisateur détectée, potentiel faille détectée.');
    }

    if (!unpreparedQueriesFound) {
        console.log('Utilisation de requêtes préparées détectée.');
    } else {
        console.log('Les requêtes ne sont pas préparées, potentiel faille détectée.');
    }

    if (!insecureEscapingMethodsFound) {
        console.log('Échappement des caractères spéciaux détecté.');
    } else {
        console.log('Aucun échappement des caractères spéciaux détecté.');
    }
}
